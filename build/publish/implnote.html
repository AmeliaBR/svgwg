<!DOCTYPE html>

<!--
  Scalable Vector Graphics (SVG) 2
  Appendix C: Implementation Requirements

  Note: This document is generated from ../master/implnote.html.
  Run "make" from the root of the repository to regenerate it.
  -->

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head><meta charset="UTF-8"/>
  <title>Implementation Requirements — SVG 2</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
  
  
  <!--
  <link rel="alternate stylesheet" title="CSS3 Unmodified"       type="text/css" media="screen" href="style/default.css"/>
  <link rel="alternate stylesheet" title="SVG 1.1"               type="text/css" media="screen" href="style/svg-style.css"/>
  -->
  <!-- W3C style sheet will be added here during processing. -->
<link rel="stylesheet" title="Default" href="style/svg.css" type="text/css" media="screen"/><link rel="alternate stylesheet" title="Only annotations for publication" href="style/default_no_maturity.css" type="text/css" media="screen"/><link rel="alternate stylesheet" title="No issues/annotations" href="style/default_no_issues.css" type="text/css" media="screen"/><link rel="stylesheet" href="//www.w3.org/StyleSheets/TR/2016/W3C-ED" type="text/css" media="screen"/><script src="style/link-fixup.js"></script><script data-script-mathjax="" src="style/load-mathjax.js"></script></head>
<body class="chapter-implnote"><div class="header top"><span class="namedate">SVG 2 – 13 July 2016</span> <a href="Overview.html">Top</a> ⋅ <a href="toc.html">Contents</a> ⋅ <a href="idl.html">Previous</a> ⋅ <a href="conform.html">Next</a> ⋅ <a href="eltindex.html">Elements</a> ⋅ <a href="attindex.html">Attributes</a> ⋅ <a href="propidx.html">Properties</a></div>

<h1>Appendix C: Implementation Requirements</h1><nav id="toc"><h2 id="Contents" class="contents">Contents</h2><ol class="toc appendix-toc"><li><ol class="toc appendix-toc"><li><a href="implnote.html#Introduction"><span class="secno">C.1.</span> Introduction</a></li><li><a href="implnote.html#ErrorProcessing"><span class="secno">C.2.</span> Error processing</a></li><li><a href="implnote.html#RangeClamping"><span class="secno">C.3.</span> Clamping values which are restricted to a particular range</a></li><li><a href="implnote.html#ArcImplementationNotes"><span class="secno">C.4.</span> Elliptical arc implementation notes</a><ol class="toc appendix-toc"><li><a href="implnote.html#ArcSyntax"><span class="secno">C.4.1.</span> Elliptical arc syntax</a></li><li><a href="implnote.html#ArcOutOfRangeParameters"><span class="secno">C.4.2.</span> Out-of-range parameters</a></li><li><a href="implnote.html#ArcParameterizationAlternatives"><span class="secno">C.4.3.</span> Parameterization alternatives</a></li><li><a href="implnote.html#ArcConversionCenterToEndpoint"><span class="secno">C.4.4.</span> Conversion from center to endpoint parameterization</a></li><li><a href="implnote.html#ArcConversionEndpointToCenter"><span class="secno">C.4.5.</span> Conversion from endpoint to center parameterization</a></li><li><a href="implnote.html#ArcCorrectionOutOfRangeRadii"><span class="secno">C.4.6.</span> Correction of out-of-range radii</a></li></ol></li><li><a href="implnote.html#TextSelectionImplementationNotes"><span class="secno">C.5.</span> Text selection implementation notes</a></li><li><a href="implnote.html#PrintingImplementationNotes"><span class="secno">C.6.</span> Printing implementation notes</a></li></ol></li></ol></nav>

<p class="normativity"><strong>This appendix is normative.</strong></p>

<h2 id="Introduction" class="heading">C.1. Introduction<a class="self-link" href="#Introduction"></a></h2>

<p>The following are notes about implementation requirements
corresponding to various features in the SVG language.</p>

<h2 id="ErrorProcessing" class="heading">C.2. Error processing<a class="self-link" href="#ErrorProcessing"></a></h2>

<p>There are various scenarios where an SVG document fragment
is technically <em>in error</em>:</p>

<ul>
  <li>For the standalone SVG documents, when the content does not conform to the <a href="http://www.w3.org/TR/2008/REC-xml-20081126/">XML 1.0
  specification</a> [<a href="refs.html#ref-XML10">XML10</a>], such as the
  use of incorrect XML syntax
  </li>

  <li>Other situations that are described as being <em>in error</em> in this
  specification</li>
</ul>

<p>A document can go in and out of error over time. For
example, document changes from the <a href="svgdom.html">SVG DOM</a>
or from <a href="https://svgwg.org/specs/animations/">animation</a> can cause
a document to become <em>in error</em> and a further change can
cause the document to become correct again.</p>

<p>The following error processing shall occur when a document
is in error:</p>

<ul>
  <li>
    The document rendering shall continue after encountering element which has an error. The element or it's part that is in error won't be rendered.
  </li>

  <li>If the user agent has access to an error reporting
  capability such as status bar, it is recommended that the
  user agent provide whatever additional detail it can to
  enable the user or developer to quickly find the source of
  the error. For example, the user agent might provide an error
  message along with a line number and character number at
  which the error was encountered.</li>
</ul>

<p>Because of situations where a block of scripting changes
might cause a given SVG document fragment to go into and out of
error, error processing shall occur only at times when document
presentation (e.g., rendering to the display device) is
updated.</p>

<h2 id="RangeClamping" class="heading">C.3. Clamping values which are restricted to a particular range<a class="self-link" href="#RangeClamping"></a></h2>

<p>Some numeric attribute and property values have restricted
ranges, such as color component values. When out-of-range
values are provided, the user agent shall defer any error
checking until after presentation time, as composited actions
might produce intermediate values which are out-of-range but
final values which are within range.</p>

<p>Color values are not in error if they are out-of-range, even
if final computations produce an out-of-range color value at
presentation time. It is recommended that user agents clamp
color values to the nearest color value (possibly determined by
simple clipping) which the system can process as late as
possible (e.g., presentation time), although it is acceptable
for user agents to clamp color values as early as parse time.
Thus, implementation dependencies might preclude consistent
behavior across different systems when out-of-range color
values are used.</p>

<p>Opacity values out-of-range are not in error and should be
clamped to the range 0 to 1 at the time which opacity values
have to be processed (e.g., at presentation time or when it is
necessary to perform intermediate filter effect
calculations).</p>

<h2 id="ArcImplementationNotes" class="heading">C.4. Elliptical arc implementation notes<a class="self-link" href="#ArcImplementationNotes"></a></h2>

<div class="math">

<h3 id="ArcSyntax" class="heading">C.4.1. Elliptical arc syntax<a class="self-link" href="#ArcSyntax"></a></h3>

<p>An elliptical arc is a particular path command. As
such, it is described by the following parameters in order:</p>

<p>(<var>x</var><sub>1</sub>, <var>y</var><sub>1</sub>) are the absolute coordinates of the
current point on the path, obtained from the last two
parameters of the previous path command.</p>

<p><var>r<sub>x</sub></var>
and <var>r<sub>y</sub></var>
are the radii of the ellipse (also known as its semi-major and
semi-minor axes).</p>

<p><var>φ</var> is the angle from the x-axis of the current coordinate
system to the x-axis of the ellipse.</p>

<p><var>f<sub>A</sub></var> is
the large arc flag, and is 0
if an arc spanning less than or equal to 180 degrees is chosen, or 1
if an arc spanning greater than 180 degrees is chosen.</p>

<p><var>f<sub>S</sub></var> is
the sweep flag, and is 0 if
the line joining center to arc sweeps through decreasing
angles, or 1 if it sweeps
through increasing angles.</p>

<p>(<var>x</var><sub>2</sub>, <var>y</var><sub>2</sub>) are the absolute coordinates of the
final point of the arc.</p>

<p>This parameterization of elliptical arcs will be referred to
as <em>endpoint parameterization</em>. One of the
advantages of endpoint parameterization is that it permits a
consistent path syntax in which all path commands end in the
coordinates of the new "current point". The following
notes give rules and formulas to help implementers deal with
endpoint parameterization.</p>

<h3 id="ArcOutOfRangeParameters" class="heading">C.4.2. Out-of-range parameters<a class="self-link" href="#ArcOutOfRangeParameters"></a></h3>

<p>Arbitrary numerical values are permitted for all elliptical
arc parameters, but where these values are invalid or
out-of-range, an implementation must make sense of them as
follows:</p>

<p>If the endpoints (<var>x</var><sub>1</sub>, <var>y</var><sub>1</sub>)
and (<var>x</var><sub>2</sub>, <var>y</var><sub>2</sub>) are identical, then this is
equivalent to omitting the elliptical arc segment entirely.</p>

<p>If <var>r<sub>x</sub></var> = 0 or
<var>r<sub>y</sub></var> = 0
then this arc is treated as a straight line segment
(a "lineto") joining the endpoints.</p>

<p>If <var>r<sub>x</sub></var> or <var>r<sub>y</sub></var>
have negative signs, these are dropped; the absolute value is
used instead.</p>

<p>If <var>r<sub>x</sub></var>, <var>r<sub>y</sub></var>
and <var>φ</var> are such that there is no solution
(basically, the ellipse is not big enough to reach
from (<var>x</var><sub>1</sub>, <var>y</var><sub>1</sub>)
to (<var>x</var><sub>2</sub>, <var>y</var><sub>2</sub>))
then the ellipse is scaled up
uniformly until there is exactly one solution (until the
ellipse is just big enough).</p>

<p><var>φ</var> is taken mod 360 degrees.</p>

<p>Any nonzero value for either of the flags <var>f<sub>A</sub></var>
or <var>f<sub>S</sub></var> is taken to mean the value 1.</p>

<p>This forgiving yet consistent treatment of out-of-range
values ensures that:</p>

<ul>
  <li>The inevitable approximations arising from computer
  arithmetic cannot cause a valid set of values written by one
  SVG implementation to be treated as invalid when read by
  another SVG implementation. This would otherwise be a
  problem for common boundary cases such as a semicircular
  arc.</li>

  <li>Continuous animations that cause parameters to pass
  through invalid values are not a problem. The motion
  remains continuous.</li>
</ul>

<h3 id="ArcParameterizationAlternatives" class="heading">C.4.3. Parameterization alternatives<a class="self-link" href="#ArcParameterizationAlternatives"></a></h3>

<p>An arbitrary point (<var>x</var>, <var>y</var>) on the elliptical
arc can be described by the 2-dimensional matrix equation:</p>

(F.6.3.1)
<div role="math" aria-describedby="math-arbitrary-point-on-elliptical-arc">
  <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
    <mrow>
      <mo>(</mo>
      <mtable>
        <mtr><mtd><mi>x</mi></mtd></mtr>
        <mtr><mtd><mi>y</mi></mtd></mtr>
      </mtable>
      <mo>)</mo>
      <mo>=</mo>
      <mo>(</mo>
      <mtable>
        <mtr>
          <mtd><mrow><mi>cos</mi><mo>⁡</mo><mi>φ</mi></mrow></mtd>
          <mtd><mrow><mo>-</mo><mi>sin</mi><mo>⁡</mo><mi>φ</mi></mrow></mtd>
        </mtr>
        <mtr>
          <mtd><mrow><mi>sin</mi><mo>⁡</mo><mi>φ</mi></mrow></mtd>
          <mtd><mrow><mi>cos</mi><mo>⁡</mo><mi>φ</mi></mrow></mtd>
        </mtr>
      </mtable>
      <mo>)</mo>
      <mo>·</mo>
      <mo>(</mo>
      <mtable>
        <mtr>
          <mtd><mrow><msub><mi>r</mi><mi>x</mi></msub><mo>⁢</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow></mtd>
        </mtr>
        <mtr>
          <mtd><mrow><msub><mi>r</mi><mi>y</mi></msub><mo>⁢</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mrow></mtd>
        </mtr>
      </mtable>
      <mo>)</mo>
      <mo>+</mo>
      <mo>(</mo>
      <mtable>
        <mtr><mtd><msub><mi>c</mi><mi>x</mi></msub></mtd></mtr>
        <mtr><mtd><msub><mi>c</mi><mi>y</mi></msub></mtd></mtr>
      </mtable>
      <mo>)</mo>
    </mrow>
  </math>
  <pre id="math-arbitrary-point-on-elliptical-arc">
    x = rx*cos(θ)*cos(φ) - ry*sin(θ)*sin(φ) + cx
    y = rx*cos(θ)*sin(φ) + ry*sin(θ)*cos(φ) + cy
  </pre>
</div>

<p>(<var>c<sub>x</sub></var>, <var>c<sub>y</sub></var>) are
the coordinates of the center of the ellipse.</p>

<p><var>r<sub>x</sub></var> and <var>r<sub>y</sub></var>
are the radii of the ellipse (also known as its semi-major and
semi-minor axes).</p>

<div class="ready-for-wg-review">
<p><var>φ</var> is the angle from the
x-axis of the current coordinate system to the x-axis of the
ellipse.</p>

<p><var>θ</var> is the angle around the arc that the point 
(<var>x</var>, <var>y</var>) lies at, and ranges from:</p>

<ul>
  <li><var>θ</var><sub>1</sub> which is
  the start angle of the elliptical arc prior to the stretch and
  rotate operations.</li>

  <li><var>θ</var><sub>2</sub> which is
  the end angle of the elliptical arc prior to the stretch and
  rotate operations.</li>

  <li>Δ<var>θ</var> which is the difference between these
  two angles.</li>
</ul>
</div>
<p>If one thinks of an ellipse as a circle that has been
stretched and then rotated, then <var>θ</var><sub>1</sub>,
<var>θ</var><sub>2</sub> and Δ<var>θ</var>
are the start angle, end angle and sweep angle, respectively
of the arc prior to the stretch and rotate operations.
This leads to an alternate parameterization which is common
among graphics APIs, which will be referred to as <em>center
parameterization</em>. In the next sections, formulas are
given for mapping in both directions between center
parameterization and endpoint parameterization.</p>

<h3 id="ArcConversionCenterToEndpoint" class="heading">C.4.4. Conversion from center to endpoint parameterization<a class="self-link" href="#ArcConversionCenterToEndpoint"></a></h3>

<p>Given the following variables:</p>

<p class="indented separated">
  <var>c<sub>x</sub></var>
  <var>c<sub>y</sub></var>
  <var>r<sub>x</sub></var>
  <var>r<sub>y</sub></var>
  <var>φ</var>
  <var>θ</var><sub>1</sub>
  Δ<var>θ</var>
</p>

<p>the task is to find:</p>

<p class="indented separated">
  <var>x</var><sub>1</sub>
  <var>y</var><sub>1</sub>
  <var>x</var><sub>2</sub>
  <var>y</var><sub>2</sub>
  <var>f<sub>A</sub></var>
  <var>f<sub>S</sub></var>
</p>

<p>This can be achieved using the following formulas:</p>

<table style="width: 90%">
  <tr>
    <td>
    <!--<img
    alt="Equation F.6.4.1"
    src="images/implnote/arcs/image004.png" />-->

<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
      <mfenced open="(" close=")">
          <mtable rowalign="center">
              <mtr>
                <mtd>
                  <msub>
                      <mi>x</mi>
                      <mi>1</mi>
                    </msub>
                </mtd>
              </mtr>
              <mtr>
                <mtd>
                    <msub>
                      <mi>y</mi>
                      <mi>1</mi>
                    </msub>
                </mtd>
              </mtr>
            </mtable>
        </mfenced>
    <mo>=</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mrow>
              <mn>cos</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
          <mtd>
            <mrow>
              <mo lspace="2px" rspace="2px">-</mo>
              <mn>sin</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mn>sin</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
          <mtd>
            <mrow>
              <mn>cos</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo lspace="2px" rspace="2px">⋅</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mrow>
              <msub>
                <mi>r</mi>
                <mi>x</mi>
              </msub>
              <mi> </mi>
              <mn>cos</mn>
              <msub>
                <mi mathvariant="italic">θ</mi>
                <mi mathvariant="italic">1</mi>
              </msub>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <msub>
                <mi>r</mi>
                <mi>y</mi>
              </msub>
              <mi> </mi>
              <mn>sin</mn>
              <msub>
                <mi mathvariant="italic">θ</mi>
                <mi mathvariant="italic">1</mi>
              </msub>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo lspace="2px" rspace="2px">+</mo>
      <mfenced open="(" close=")">
          <mtable rowalign="center">
              <mtr>
                <mtd>
                  <msub>
                      <mi>c</mi>
                      <mi>x</mi>
                    </msub>
                </mtd>
              </mtr>
              <mtr>
                <mtd>
                    <msub>
                      <mi>c</mi>
                      <mi>y</mi>
                    </msub>
                </mtd>
              </mtr>
            </mtable>
        </mfenced>
  </mrow>
</math>
</div>

    </td>
    <td style="text-align: right">(F.6.4.1)</td>
  </tr>
  <tr>
    <td>
    <!--<img
    alt="Equation F.6.4.2"
    src="images/implnote/arcs/image006.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <msub>
              <mi>x</mi>
              <mi mathvariant="italic">2</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>y</mi>
              <mi mathvariant="italic">2</mi>
            </msub>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo>=</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mrow>
              <mn>cos</mn>
              <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">φ</mi>
            </mrow>
          </mtd>
          <mtd>
            <mrow>
              <mo lspace="2px" rspace="2px">-</mo>
              <mn>sin</mn>
              <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">φ</mi>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mn>sin</mn>
              <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">φ</mi>
            </mrow>
          </mtd>
          <mtd>
            <mrow>
              <mn>cos</mn>
              <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">φ</mi>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo lspace="2px" rspace="2px">⋅</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mrow>
              <msub>
                <mi>r</mi>
                <mi>x</mi>
              </msub>
              <mi> </mi>
              <mn>cos</mn>
              <mfenced open="(" close=")">
                <mrow>
                  <msub>
                    <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">θ</mi>
                    <mi mathvariant="italic">1</mi>
                  </msub>
                  <mo lspace="2px" rspace="2px">+</mo>
                  <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">Δ</mi>
                  <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">θ</mi>
                </mrow>
              </mfenced>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <msub>
                <mi>r</mi>
                <mi>y</mi>
              </msub>
              <mi> </mi>
              <mn>sin</mn>
              <mfenced open="(" close=")">
                <mrow>
                  <msub>
                    <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">θ</mi>
                    <mi mathvariant="italic">1</mi>
                  </msub>
                  <mo lspace="2px" rspace="2px">+</mo>
                  <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">Δ</mi>
                  <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">θ</mi>
                </mrow>
              </mfenced>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo lspace="2px" rspace="2px">+</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <msub>
              <mi>c</mi>
              <mi>x</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>c</mi>
              <mi>y</mi>
            </msub>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mrow>
</math>
</div>
    </td>
    <td style="text-align: right">(F.6.4.2)</td>
  </tr>
  <tr>
    <td>
    <!--<img
    alt="Equation F.6.4.3"
    src="images/implnote/arcs/image008.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <msub>
      <mi>f</mi>
      <mi>A</mi>
    </msub>
    <mo>=</mo>
    <mfenced open="{" close="">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mrow>
              <mn>1</mn>
              <mi mathvariant="italic"> </mi>
              <mi mathvariant="italic"> </mi>
              <mtext>if</mtext>
              <mi mathvariant="italic"> </mi>
              <mi mathvariant="italic"> </mi>
              <mfenced open="|" close="|">
                <mrow>
                  <mi>Δ</mi>
                  <mi mathvariant="italic">θ</mi>
                </mrow>
              </mfenced>
              <mo mathvariant="italic">></mo>
              <mn>180</mn>
              <mi mathvariant="normal">°</mi>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mtext>0</mtext>
              <mi mathvariant="italic"> </mi>
              <mi mathvariant="italic"> </mi>
              <mtext>if</mtext>
              <mi mathvariant="italic"> </mi>
              <mi mathvariant="italic"> </mi>
              <mfenced open="|" close="|">
                <mrow>
                  <mi>Δ</mi>
                  <mi mathvariant="italic">θ</mi>
                </mrow>
              </mfenced>
              <mo lspace="3px" rspace="3px">≤</mo>
              <mn>180</mn>
              <mi mathvariant="normal">°</mi>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mrow>
</math>
</div>

    </td>
    <td style="text-align: right">(F.6.4.3)</td>
  </tr>
  <tr>
    <td>
    <!--<img
    alt="Equation F.6.4.4"
    src="images/implnote/arcs/image010.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <msub>
      <mi>f</mi>
      <mi>S</mi>
    </msub>
    <mo>=</mo>
    <mfenced open="{" close="">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mrow>
              <mn>1</mn>
              <mi mathvariant="italic">  </mi>
              <mtext>if</mtext>
              <mi mathvariant="italic">  </mi>
              <mi>Δ</mi>
              <mi mathvariant="italic">θ</mi>
              <mn> </mn>
              <mo lspace="0px" rspace="0px">></mo>
              <mtext> </mtext>
              <mn>0</mn>
              <mi mathvariant="normal">°</mi>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mtext>0</mtext>
              <mi mathvariant="italic">  </mi>
              <mtext>if</mtext>
              <mi mathvariant="italic">  </mi>
              <mi>Δ</mi>
              <mi mathvariant="italic">θ</mi>
              <mn> </mn>
              <mo lspace="0px" rspace="0px">&lt;</mo>
              <mtext> </mtext>
              <mn>0</mn>
              <mi mathvariant="normal">°</mi>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mrow>
</math>
</div>
    </td>
    <td style="text-align: right">(F.6.4.4)</td>
  </tr>
</table>

<h3 id="ArcConversionEndpointToCenter" class="heading">C.4.5. Conversion from endpoint to center parameterization<a class="self-link" href="#ArcConversionEndpointToCenter"></a></h3>

<p>Given the following variables:</p>

<p class="indented separated">
  <var>x</var><sub>1</sub>
  <var>y</var><sub>1</sub>
  <var>x</var><sub>2</sub>
  <var>y</var><sub>2</sub>
  <var>f<sub>A</sub></var>
  <var>f<sub>S</sub></var>
  <var>r<sub>x</sub></var>
  <var>r<sub>y</sub></var>
  <var>φ</var>
</p>

<p>the task is to find:</p>

<p class="indented separated">
  <var>c<sub>x</sub></var>
  <var>c<sub>y</sub></var>
  <var>θ</var><sub>1</sub>
  Δ<var>θ</var>
</p>

<p>The equations simplify after a translation which
places the origin at the midpoint of the line joining
(<var>x</var><sub>1</sub>, <var>y</var><sub>1</sub>) to
(<var>x</var><sub>2</sub>, <var>y</var><sub>2</sub>), followed by
a rotation to line up the coordinate axes with the axes of the ellipse.
All transformed coordinates will be written with primes. They are
computed as intermediate values on the way toward finding the required
center parameterization variables. This procedure consists of the
following steps:</p>

<ul>
  <li>
    <p><em>Step 1: Compute</em> (<var>x</var><sub>1</sub>′, <var>y</var><sub>1</sub>′)</p>
    <table style="width: 90%">
      <tr>
        <td><!--<img
        alt="Equation F.6.5.1"
        src="images/implnote/arcs/image012.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <msup>
              <msub>
                <mi>x</mi>
                <mi mathvariant="italic">1</mi>
              </msub>
              <mo mathvariant="italic" fontfamily="Lucida Sans Unicode">′</mo>
            </msup>
         </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msup>
              <msub>
                <mi>y</mi>
                <mi mathvariant="italic">1</mi>
             </msub>
              <mo mathvariant="italic" fontfamily="Lucida Sans Unicode">′</mo>
            </msup>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo>=</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mrow>
              <mn>cos</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
          <mtd>
            <mrow>
              <mn>sin</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mo>-</mo>
              <mn>sin</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
          <mtd>
            <mrow>
              <mn>cos</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo lspace="2px" rspace="2px">⋅</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mfrac>
              <mrow>
                <msub>
                  <mi>x</mi>
                  <mi mathvariant="italic">1</mi>
                </msub>
                <mo mathvariant="italic">-</mo>
                <msub>
                  <mi>x</mi>
                  <mi mathvariant="italic">2</mi>
                </msub>
              </mrow>
              <mi mathvariant="italic">2</mi>
            </mfrac>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mfrac>
              <mrow>
                <msub>
                  <mi>y</mi>
                  <mi mathvariant="italic">1</mi>
                </msub>
                <mo mathvariant="italic">-</mo>
                <msub>
                  <mi>y</mi>
                  <mi mathvariant="italic">2</mi>
                </msub>
              </mrow>
              <mi mathvariant="italic">2</mi>
            </mfrac>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mrow>
</math>
</div>
        </td>
        <td style="text-align: right">(F.6.5.1)</td>
      </tr>
    </table>
  </li>

  <li>
    <p><em>Step 2: Compute</em> (<var>c<sub>x</sub></var>′, <var>c<sub>y</sub></var>′)</p>
    <table style="width: 90%">
      <tr>
        <td><!--<img
        alt="Equation F.6.5.2"
        src="images/implnote/arcs/image014.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <msup>
              <msub>
                <mi>c</mi>
                <mi>x</mi>
              </msub>
              <mo>′</mo>
            </msup>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msup>
              <msub>
                <mi>c</mi>
                <mi>y</mi>
              </msub>
              <mo>′</mo>
            </msup>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo>=</mo>
    <mo lspace="2px" rspace="2px">±</mo>
    <msqrt>
        <mfrac>
          <mrow>
            <msup>
              <msub>
                <mi>r</mi>
                <mi>x</mi>
              </msub>
              <mn>2</mn>
            </msup>
            <mtext> </mtext>
            <msup>
              <msub>
                <mi>r</mi>
                <mi>y</mi>
              </msub>
              <mn>2</mn>
            </msup>
            <mo>-</mo>
            <msup>
              <msub>
                <mi>r</mi>
                <mi>x</mi>
              </msub>
              <mn>2</mn>
            </msup>
            <msup>
              <mfenced open="(" close=")">
                <msup>
                  <msub>
                    <mi>y</mi>
                    <mn>1</mn>
                  </msub>
                  <mo>′</mo>
                </msup>
              </mfenced>
              <mn>2</mn>
            </msup>
            <mo>-</mo>
            <msup>
              <msub>
                <mi>r</mi>
                <mi>y</mi>
              </msub>
              <mn>2</mn>
            </msup>
            <msup>
              <mfenced open="(" close=")">
                <msup>
                  <msub>
                    <mi>x</mi>
                    <mn>1</mn>
                  </msub>
                  <mo>′</mo>
                </msup>
              </mfenced>
              <mn>2</mn>
            </msup>
          </mrow>
          <mrow>
            <msup>
              <msub>
                <mi>r</mi>
                <mi>x</mi>
              </msub>
              <mn>2</mn>
            </msup>
            <msup>
              <mfenced open="(" close=")">
                <msup>
                  <msub>
                    <mi>y</mi>
                    <mn>1</mn>
                  </msub>
                  <mo>′</mo>
                </msup>
              </mfenced>
              <mn>2</mn>
            </msup>
            <mo>+</mo>
            <msup>
              <msub>
                <mi>r</mi>
                <mi>y</mi>
              </msub>
              <mn>2</mn>
            </msup>
            <msup>
              <mfenced open="(" close=")">
                <msup>
                  <msub>
                    <mi>x</mi>
                    <mn>1</mn>
                  </msub>
                  <mo>′</mo>
                </msup>
              </mfenced>
              <mn>2</mn>
            </msup>
          </mrow>
        </mfrac>
    </msqrt>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mfrac>
              <mrow>
                <msub>
                  <mi>r</mi>
                  <mi>x</mi>
                </msub>
                <mtext> </mtext>
                <msup>
                  <msub>
                    <mi>y</mi>
                    <mn>1</mn>
                  </msub>
                  <mo>′</mo>
                </msup>
              </mrow>
              <msub>
                <mi>r</mi>
                <mi>y</mi>
              </msub>
            </mfrac>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mo>-</mo>
              <mfrac>
                <mrow>
                  <msub>
                    <mi>r</mi>
                    <mi>y</mi>
                  </msub>
                  <mtext> </mtext>
                  <msup>
                    <msub>
                      <mi>x</mi>
                      <mn>1</mn>
                    </msub>
                    <mo>′</mo>
                  </msup>
                </mrow>
                <msub>
                  <mi>r</mi>
                  <mi>x</mi>
                </msub>
              </mfrac>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mrow>
</math>
</div>
        </td>
        <td style="text-align: right">(F.6.5.2)</td>
      </tr>
    </table>
    <p>where the + sign is chosen if <var>f<sub>A</sub></var> ≠ <var>f<sub>S</sub></var>, and
    the − sign is chosen if <var>f<sub>A</sub></var> = <var>f<sub>S</sub></var>.</p>
  </li>

  <li>
    <p><em>Step 3: Compute</em> (<var>c<sub>x</sub></var>, <var>c<sub>y</sub></var>)
    <em>from</em> (<var>c<sub>x</sub></var>′, <var>c<sub>y</sub></var>′)</p>
    <table style="width: 90%">
      <tr>
        <td><!--<img
        alt="Equation F.6.5.3"
        src="images/implnote/arcs/image016.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <msub>
              <mi>c</mi>
              <mi>x</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>c</mi>
              <mi>y</mi>
            </msub>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo>=</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mrow>
              <mn>cos</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
          <mtd>
            <mrow>
              <mo>-</mo>
              <mn>sin</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mn>sin</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
          <mtd>
            <mrow>
              <mn>cos</mn>
              <mi mathvariant="italic">φ</mi>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo lspace="2px" rspace="2px">⋅</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <msup>
              <msub>
                <mi>c</mi>
                <mi>x</mi>
              </msub>
              <mo lspace="0px" form="infix">'</mo>
            </msup>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msup>
              <msub>
                <mi>c</mi>
                <mi>y</mi>
              </msub>
              <mo lspace="0px" form="infix">'</mo>
            </msup>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo>+</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mfrac>
              <mrow>
                <msub>
                  <mi>x</mi>
                  <mn>1</mn>
                </msub>
                <mo>+</mo>
                <msub>
                  <mi>x</mi>
                  <mn>2</mn>
                </msub>
              </mrow>
              <mn>2</mn>
            </mfrac>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mfrac>
              <mrow>
                <msub>
                  <mi>y</mi>
                  <mn>1</mn>
                </msub>
                <mo>+</mo>
                <msub>
                  <mi>y</mi>
                  <mn>2</mn>
                </msub>
              </mrow>
              <mn>2</mn>
            </mfrac>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mrow>
</math>
</div>
        </td>
        <td style="text-align: right">(F.6.5.3)</td>
      </tr>
    </table>
  </li>

  <li>
    <p><em>Step 4: Compute</em> <var>θ</var><sub>1</sub> and Δ<var>θ</var></p>
    <p>In general, the angle between two vectors
    (<var>u<sub>x</sub></var>, <var>u<sub>y</sub></var>)
    and (<var>v<sub>x</sub></var>, <var>v<sub>y</sub></var>) can be computed as</p>
    <table style="width: 90%">
      <tr>
        <td><!--<img
        alt="Equation F.6.5.4"
        src="images/implnote/arcs/image018.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mo lspace="3px" rspace="3px">∠</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mover>
              <mi>u</mi>
              <mo>⇀</mo>
            </mover>
          </mtd>
          <mtd>
            <mn>,</mn>
          </mtd>
          <mtd>
            <mover>
              <mi>v</mi>
              <mo>⇀</mo>
            </mover>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo>=</mo>
    <mo lspace="2px" rspace="2px">±</mo>
    <mn>arccos</mn>
    <mfenced open="(" close=")">
      <mfrac>
        <mrow>
          <mover>
            <mi>u</mi>
            <mo>⇀</mo>
          </mover>
          <mo lspace="6px" rspace="6px">⋅</mo>
          <mover>
            <mi>v</mi>
            <mo>⇀</mo>
          </mover>
        </mrow>
        <mrow>
          <mfenced open="‖" close="‖">
            <mover>
              <mi>u</mi>
              <mo>⇀</mo>
            </mover>
          </mfenced>
          <mi> </mi>
          <mfenced open="‖" close="‖">
            <mover>
              <mi>v</mi>
              <mo>⇀</mo>
            </mover>
          </mfenced>
        </mrow>
      </mfrac>
    </mfenced>
  </mrow>
</math>
</div>
        </td>
        <td style="text-align: right">(F.6.5.4)</td>
      </tr>
    </table>

    <p>where the ± sign appearing here is the sign of
    <var>u<sub>x</sub></var> <var>v<sub>y</sub></var> − <var>u<sub>y</sub></var> <var>v<sub>x</sub></var>.</p>

    <p>This angle function can be used to express <var>θ</var><sub>1</sub> and
    Δ<var>θ</var> as follows:</p>

    <table style="width: 90%">
      <tr>
        <td><!--<img
        alt="Equation F.6.5.5"
        src="images/implnote/arcs/image020.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <msub>
      <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">θ</mi>
      <mi>1</mi>
    </msub>
    <mo>=</mo>
    <mo lspace="3px" rspace="3px">∠</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mfenced open="(" close=")">
              <mtable rowalign="center">
                <mtr>
                  <mtd>
                    <mn>1</mn>
                  </mtd>
                </mtr>
                <mtr>
                  <mtd>
                    <mn>0</mn>
                  </mtd>
                </mtr>
              </mtable>
            </mfenced>
          </mtd>
          <mtd>
            <mi mathvariant="italic">,</mi>
          </mtd>
          <mtd>
            <mfenced open="(" close=")">
              <mtable rowalign="center">
                <mtr>
                  <mtd>
                    <mfrac>
                      <mrow>
                        <msup>
                          <msub>
                            <mi>x</mi>
                            <mi mathvariant="italic">1</mi>
                          </msub>
                          <mo>′</mo>
                        </msup>
                        <mo>-</mo>
                        <msup>
                          <msub>
                            <mi>c</mi>
                            <mi>x</mi>
                          </msub>
                          <mo>′</mo>
                        </msup>
                      </mrow>
                      <msub>
                        <mi>r</mi>
                        <mi>x</mi>
                      </msub>
                    </mfrac>
                  </mtd>
                </mtr>
                <mtr>
                  <mtd>
                    <mfrac>
                      <mrow>
                        <msup>
                          <msub>
                            <mi>y</mi>
                            <mi mathvariant="italic">1</mi>
                          </msub>
                          <mo>′</mo>
                        </msup>
                        <mo>-</mo>
                        <msup>
                          <msub>
                            <mi>c</mi>
                            <mi>y</mi>
                          </msub>
                          <mo>′</mo>
                        </msup>
                      </mrow>
                      <msub>
                        <mi>r</mi>
                        <mi>y</mi>
                      </msub>
                    </mfrac>
                  </mtd>
                </mtr>
              </mtable>
            </mfenced>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mrow>
</math>
</div>
        </td>
        <td style="text-align: right">(F.6.5.5)</td>
      </tr>
      <tr>
        <td><!--<img
        alt="Equation F.6.5.6"
        src="images/implnote/arcs/image022.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mi>Δ</mi>
    <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">θ</mi>
    <mo lspace="3px" rspace="3px">≡</mo>
    <mo lspace="3px" rspace="3px">∠</mo>
    <mfenced open="(" close=")">
      <mtable rowalign="center">
        <mtr>
          <mtd>
            <mfenced open="(" close=")">
              <mtable rowalign="center">
                <mtr>
                  <mtd>
                    <mfrac>
                      <mrow>
                        <msup>
                          <msub>
                            <mi>x</mi>
                            <mi mathvariant="italic">1</mi>
                          </msub>
                          <mo>′</mo>
                        </msup>
                        <mo>-</mo>
                        <msup>
                          <msub>
                            <mi>c</mi>
                            <mi>x</mi>
                          </msub>
                          <mo>′</mo>
                        </msup>
                      </mrow>
                      <msub>
                        <mi>r</mi>
                        <mi>x</mi>
                      </msub>
                    </mfrac>
                  </mtd>
                </mtr>
                <mtr>
                  <mtd>
                    <mfrac>
                      <mrow>
                        <msup>
                          <msub>
                            <mi>y</mi>
                            <mi mathvariant="italic">1</mi>
                          </msub>
                          <mo>′</mo>
                        </msup>
                        <mo>-</mo>
                        <msup>
                          <msub>
                            <mi>c</mi>
                            <mi>y</mi>
                          </msub>
                          <mo>′</mo>
                        </msup>
                      </mrow>
                      <msub>
                        <mi>r</mi>
                        <mi>y</mi>
                      </msub>
                    </mfrac>
                  </mtd>
                </mtr>
              </mtable>
            </mfenced>
          </mtd>
          <mtd>
            <mi mathvariant="italic">,</mi>
          </mtd>
          <mtd>
            <mfenced open="(" close=")">
              <mtable rowalign="center">
                <mtr>
                  <mtd>
                    <mfrac>
                      <mrow>
                        <msup>
                          <mrow>
                            <mo>-</mo>
                            <msub>
                              <mi>x</mi>
                              <mi mathvariant="italic">1</mi>
                            </msub>
                          </mrow>
                          <mo>′</mo>
                        </msup>
                        <mo>-</mo>
                        <msup>
                          <msub>
                            <mi>c</mi>
                            <mi>x</mi>
                          </msub>
                          <mo>′</mo>
                        </msup>
                      </mrow>
                      <msub>
                        <mi>r</mi>
                        <mi>x</mi>
                      </msub>
                    </mfrac>
                  </mtd>
                </mtr>
                <mtr>
                  <mtd>
                    <mfrac>
                      <mrow>
                        <msup>
                          <mrow>
                            <mo>-</mo>
                            <msub>
                              <mi>y</mi>
                              <mi mathvariant="italic">1</mi>
                            </msub>
                          </mrow>
                          <mo>′</mo>
                        </msup>
                        <mo>-</mo>
                        <msup>
                          <msub>
                            <mi>c</mi>
                            <mi>y</mi>
                          </msub>
                          <mo>′</mo>
                        </msup>
                      </mrow>
                      <msub>
                        <mi>r</mi>
                        <mi>y</mi>
                      </msub>
                    </mfrac>
                  </mtd>
                </mtr>
              </mtable>
            </mfenced>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mi mathvariant="italic"> </mi>
    <mn>mod 360</mn>
    <mi>°</mi>
  </mrow>
</math>
</div>
        </td>
        <td style="text-align: right">(F.6.5.6)</td>
      </tr>
    </table>

    <p>where Δ<var>θ</var> is fixed in the range
    −360° &lt; Δ<var>θ</var> &lt; 360° such that:</p>

    <p class="indented">if <var>f<sub>S</sub></var> = 0, then Δ<var>θ</var> &lt; 0,</p>
    <p class="indented">else if <var>f<sub>S</sub></var> = 1, then Δ<var>θ</var> > 0.</p>

    <p>In other words, if <var>f<sub>S</sub></var> = 0 and the
    right side of (F.6.5.6) is greater than 0, then subtract 360°,
    whereas if <var>f<sub>S</sub></var> = 1 and the right
    side of (F.6.5.6) is less than 0, then add 360°. In all other cases
    leave it as is.</p>
  </li>
</ul>

<h3 id="ArcCorrectionOutOfRangeRadii" class="heading">C.4.6. Correction of out-of-range radii<a class="self-link" href="#ArcCorrectionOutOfRangeRadii"></a></h3>

<p>This section formalizes the adjustments to out-of-range
<var>r<sub>x</sub></var> and <var>r<sub>y</sub></var> mentioned in
F.6.2. Algorithmically these adjustments consist of the following
steps:</p>

<ul>
  <li>
    <p><em>Step 1: Ensure radii are non-zero</em></p>
    <p>If <var>r<sub>x</sub></var> = 0 or
    <var>r<sub>y</sub></var> = 0, then treat
    this as a straight line from (<var>x</var><sub>1</sub>, <var>y</var><sub>1</sub>)
    to (<var>x</var><sub>2</sub>, <var>y</var><sub>2</sub>) and stop. Otherwise,</p>
  </li>

  <li>
    <p><em>Step 2: Ensure radii are positive</em></p>
    <p>Take the absolute value of <var>r<sub>x</sub></var> and
    <var>r<sub>y</sub></var>:</p>
    <table style="width: 90%">
      <tr>
        <td><!--<img
        alt="Equation F.6.6.1"
        src="images/implnote/arcs/image024.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mtable columnalign="left">
    <mtr>
      <mtd>
        <msub>
          <mi>r</mi>
          <mi>y</mi>
        </msub>
        <mo lspace="3px" rspace="3px">←</mo>
        <mfenced open="|" close="|">
          <msub>
            <mi>r</mi>
            <mi>y</mi>
          </msub>
        </mfenced>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <mrow/>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <msub>
          <mi>r</mi>
          <mi>y</mi>
        </msub>
        <mo lspace="3px" rspace="3px">←</mo>
        <mfenced open="|" close="|">
          <msub>
            <mi>r</mi>
            <mi>y</mi>
          </msub>
        </mfenced>
      </mtd>
    </mtr>
  </mtable>
</math>
</div>
        </td>
        <td style="text-align: right">(F.6.6.1)</td>
      </tr>
    </table>
  </li>

  <li>
    <p><em>Step 3: Ensure radii are large enough</em></p>
    <p>Using the primed coordinate values of equation (F.6.5.1),
    compute</p>
    <table style="width: 90%">
      <tr>
        <td><!--<img
        alt="Equation F.6.6.2"
        src="images/implnote/arcs/image026.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mi mathvariant="italic">Λ</mi>
    <mo>=</mo>
    <mfrac>
      <msup>
        <mfenced open="(" close=")">
          <msup>
            <msub>
              <mi>x</mi>
              <mi mathvariant="italic">1</mi>
            </msub>
            <mo fontfamily="Lucida Sans Unicode">′</mo>
          </msup>
        </mfenced>
        <mi mathvariant="italic">2</mi>
      </msup>
      <msup>
        <msub>
          <mi>r</mi>
          <mi>x</mi>
        </msub>
        <mi mathvariant="italic">2</mi>
      </msup>
    </mfrac>
    <mo>+</mo>
    <mfrac>
      <msup>
        <mfenced open="(" close=")">
          <msup>
            <msub>
              <mi>y</mi>
              <mi mathvariant="italic">1</mi>
            </msub>
            <mo fontfamily="Lucida Sans Unicode">′</mo>
          </msup>
        </mfenced>
        <mi mathvariant="italic">2</mi>
      </msup>
      <msup>
        <msub>
          <mi>r</mi>
          <mi>y</mi>
        </msub>
        <mi mathvariant="italic">2</mi>
      </msup>
    </mfrac>
  </mrow>
</math>
</div>
        </td>
        <td style="text-align: right">(F.6.6.2)</td>
      </tr>
    </table>
    <p>If the result of the above equation is less than or equal to
    1, then no further change need be made to <var>r<sub>x</sub></var>
    and <var>r<sub>y</sub></var>. If
    the result of the above equation is greater than 1, then make
    the replacements</p>
    <table style="width: 90%">
      <tr>
        <td><!--<img
        alt="Equation F.6.6.3"
        src="images/implnote/arcs/image028.png" />-->
<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mtable columnalign="left">
    <mtr>
      <mtd>
        <msub>
          <mi>r</mi>
          <mi>x</mi>
        </msub>
        <mo lspace="3px" rspace="3px">←</mo>
        <msqrt>
          <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">Λ</mi>
        </msqrt>
        <mi mathvariant="italic"> </mi>
        <msub>
          <mi>r</mi>
          <mi>x</mi>
        </msub>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <mrow/>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <msub>
          <mi>r</mi>
          <mi>y</mi>
        </msub>
        <mo lspace="3px" rspace="3px">←</mo>
        <msqrt>
          <mi mathvariant="italic" fontfamily="Lucida Sans Unicode">Λ</mi>
        </msqrt>
        <mi mathvariant="italic"> </mi>
        <msub>
          <mi>r</mi>
          <mi>y</mi>
        </msub>
      </mtd>
    </mtr>
  </mtable>
</math>
</div>
        </td>
        <td style="text-align: right">(F.6.6.3)</td>
      </tr>
    </table>
  </li>

  <li>
    <p><em>Step 4: Proceed with computations</em></p>
    <p>Proceed with the remaining elliptical arc computations, such
    as those in section F.6.5. Note: As a consequence of the
    radii corrections in this section, equation (F.6.5.2) for the
    center of the ellipse always has at least one solution (i.e.
    the radicand is never negative). In the case that the
    radii are scaled up using equation (F.6.6.3), the radicand of
    (F.6.5.2) is zero and there is exactly one solution for the
    center of the ellipse.</p>
  </li>
</ul>

</div>

<h2 id="TextSelectionImplementationNotes" class="heading">C.5. Text selection implementation notes<a class="self-link" href="#TextSelectionImplementationNotes"></a></h2>

<p>The following implementation notes describe the algorithm
for deciding which characters are selected during a <a href="text.html#TextSelection">text selection</a>
operation.</p>

<p>As the text selection operation occurs (e.g., while the user
clicks and drags the mouse to identify the selection), the user
agent determines a <em>start selection position</em> and an
<em>end selection position</em>, each of which represents a
position in the text string between two characters. After
determining start selection position and end selection
position, the user agent selects the appropriate characters,
where the resulting text selection consists of either:</p>

<ul>
  <li>no selection or</li>

  <li>a <em>start character</em>, an <em>end character</em>
  (possibly the same character), and all of the characters
  within the same <span class="element-name">‘<a href="text.html#TextElement"><span>text</span></a>’</span> element whose position
  in the DOM is logically between the start character and end
  character.</li>
</ul>

<p>On systems with pointer devices, to determine the <em>start
selection position</em>, the SVG user agent determines which
boundary between characters corresponding to rendered glyphs is
the best target (e.g., closest) based on the current pointer
location at the time of the event that initiates the selection
operation (e.g., the mouse down event). The user agent then
tracks the completion of the selection operation (e.g., the
mouse drag, followed ultimately by the mouse up). At the end of
the selection operation, the user agent determines which
boundary between characters is the best target (e.g., closest)
for the <em>end selection position</em>.</p>

<p>If no character reordering has occurred due to bidirectionality,
then the selection consists of all characters between the
<em>start selection position</em> and <em>end selection
position</em>. For example, if a <span class="element-name">‘<a href="text.html#TextElement"><span>text</span></a>’</span> element contains the
string "abcdef" and the start selection position and end
selection positions are 0 and 3 respectively (assuming the left
side of the "a" is position zero), then the selection will
consist of "abc".</p>

<p>When the user agent is implementing selection of
bidirectional text, and when the selection starts (or ends)
between characters which are not contiguous in logical order,
then there might be multiple potential combinations of
characters that can be considered part of the selection. The
algorithms to choose among the combinations of potential
selection options shall choose the selection option which most
closely matches the text string's visual rendering order.</p>
<p>When multiple characters map inseparably to a given set of
one or more glyphs, the user agent can either disallow the
selection to start in the middle of the glyph set or can
attempt to allocate portions of the area taken up by the glyph
set to the characters that correspond to the glyph.</p>

<p>For systems which support pointer devices such as a mouse,
the user agent is required to provide a mechanism for selecting
text even when the given text has associated event handlers or
links, which might block text selection due to event processing
precedence rules (see <a href="interact.html#PointerEvents">Pointer events</a>).
One implementation option: For platforms which support a pointer
device such as a mouse, the user agent may provide for a small
additional region around character cells which initiates text
selection operations but does not initiate event handlers or
links.</p>

<h2 id="PrintingImplementationNotes" class="heading">C.6. Printing implementation notes<a class="self-link" href="#PrintingImplementationNotes"></a></h2>

<p>For user agents which support both zooming on display
devices and printing, it is recommended that the default
printing option produce printed output that reflects the
display device's current view of the current SVG document
fragment (assuming there is no media-specific styling), taking
into account any zooming and panning done by the user, the
current state of animation, and any document changes due to DOM
and scripting. Thus, if the user zooms into a particular area
of a map on the display device and then requests a hardcopy,
the hardcopy should show the same view of the map as appears on
the display device. If a user pauses an animation and prints,
the hardcopy should show the same graphics as the currently
paused picture on the display device. If scripting has added or
removed elements from the document, then the hardcopy should
reflect the same changes that would be reflected on the
display.</p>

<p>When an SVG document is rendered on a static-only device
such as a printer which does not support SVG's animation and
scripting and facilities, then the user agent shall ignore any
animation and scripting elements in the document and render the
remaining graphics elements according to the rules in this
specification.</p>

<script src="//www.w3.org/scripts/TR/2016/fixup.js"></script><div class="header bottom"><span class="namedate">SVG 2 – 13 July 2016</span> <a href="Overview.html">Top</a> ⋅ <a href="toc.html">Contents</a> ⋅ <a href="idl.html">Previous</a> ⋅ <a href="conform.html">Next</a> ⋅ <a href="eltindex.html">Elements</a> ⋅ <a href="attindex.html">Attributes</a> ⋅ <a href="propidx.html">Properties</a></div></body>
</html>